<!--pages/genealogy/commentBoard.wxml-->

<scroll-view id="comment-list" scroll-y="true" bindscrolltolower='loadMoreComment' enable-back-to-top="true" bindscroll="bindCommentScroll">
  <!-- 猫猫名称 -->
  <view class='big-header'>
    <image class='avatar' mode='aspectFill' src='{{cat.avatar.photo_compressed || cat.avatar.photo_id}}'></image>
    <view class='name-and-count'>
      <view class='name'>{{cat.name}}的留言板</view>
      <view class='count'>共{{comment_count}}条留言</view>
    </view>
  </view>

  <!-- 评论列表 -->
  <view class="comment" wx:for="{{comments}}" wx:key="_id">
    <view class="left">
      <image wx:if="{{item.userInfo}}" class="avatar" src="{{item.userInfo.avatarUrl}}" mode='aspectFit'></image>
      <image wx:else class="avatar" src="../../../images/zdmp_logo.png" mode='aspectFit'></image>
    </view>
    <view class="right">
      <view class="info-block">
        <view class="username">{{item.userInfo.nickName || '-'}}</view>
        <view class="datetime">{{item.datetime}}</view>
      </view>
      <view class="content">{{item.content}}</view>
      <!-- <view class="operation">点赞、回复、举报</view> -->
    </view>
  </view>

  <!-- 输入框占位 -->
  <view id="input-block-ph"></view>
</scroll-view>

<!-- 悬浮的猫猫名称栏 -->
<view class='big-header fix' hidden="{{!show_fix_header}}">
  <image class='avatar' mode='aspectFill' src='{{cat.avatar.photo_compressed || cat.avatar.photo_id}}'></image>
  <view class='name-and-count'>
    <view class='name'>{{cat.name}}的留言板</view>
    <view class='count'>共{{comments.length}}条留言</view>
  </view>
</view>


<view id="input-block" style="margin-bottom: {{keyboard_height}}px;" class="{{keyboard_height>0 ? 'active': ''}}">
  <button wx:if="{{!isAuth}}" class='long primary' bindtap='getUInfo'>授权后进行留言~</button>
  <block wx:else>
    <textarea id="comment-input" value="{{comment_input}}" auto-height="{{true}}" show-confirm-bar="{{false}}" maxlength="300" placeholder="发条友善的留言吧~" adjust-position="{{false}}"
    bindfocus="commentFocus" bindblur="commentBlur" bindinput="commentInput"></textarea>
    <view wx:if="{{input_focus}}" class="send-btn" bindtap="sendComment">发 送</view>
  </block>
  <!-- 解决iOS UI兼容性 -->
  <view wx:if="{{keyboard_height == 0}}" id="input-block-bottom"></view>
</view>
